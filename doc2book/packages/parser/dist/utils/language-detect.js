"use strict";
/**
 * 语言检测工具
 * 使用 franc 库检测文本语言
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.detectLanguage = detectLanguage;
exports.getLanguageName = getLanguageName;
exports.getSupportedLanguages = getSupportedLanguages;
// franc v5 使用 CommonJS
const franc = require('franc');
/**
 * 语言代码映射（franc 代码 -> ISO 639-1）
 */
const LANGUAGE_MAP = {
    cmn: 'zh', // 中文
    eng: 'en', // 英文
    fra: 'fr', // 法文
    deu: 'de', // 德文
    spa: 'es', // 西班牙文
    por: 'pt', // 葡萄牙文
    rus: 'ru', // 俄文
    jpn: 'ja', // 日文
    kor: 'ko', // 韩文
    ara: 'ar', // 阿拉伯文
    hin: 'hi', // 印地文
    ita: 'it', // 意大利文
    nld: 'nl', // 荷兰文
    pol: 'pl', // 波兰文
    tur: 'tr', // 土耳其文
    vie: 'vi', // 越南文
    tha: 'th', // 泰文
    ind: 'id', // 印尼文
    swe: 'sv', // 瑞典文
    dan: 'da', // 丹麦文
    nor: 'no', // 挪威文
    fin: 'fi', // 芬兰文
    ces: 'cs', // 捷克文
    ell: 'el', // 希腊文
    heb: 'he', // 希伯来文
    ukr: 'uk', // 乌克兰文
    ron: 'ro', // 罗马尼亚文
    hun: 'hu', // 匈牙利文
};
/**
 * 语言名称映射
 */
const LANGUAGE_NAMES = {
    zh: '中文',
    en: '英文',
    fr: '法文',
    de: '德文',
    es: '西班牙文',
    pt: '葡萄牙文',
    ru: '俄文',
    ja: '日文',
    ko: '韩文',
    ar: '阿拉伯文',
    hi: '印地文',
    it: '意大利文',
    nl: '荷兰文',
    pl: '波兰文',
    tr: '土耳其文',
    vi: '越南文',
    th: '泰文',
    id: '印尼文',
    sv: '瑞典文',
    da: '丹麦文',
    no: '挪威文',
    fi: '芬兰文',
    cs: '捷克文',
    el: '希腊文',
    he: '希伯来文',
    uk: '乌克兰文',
    ro: '罗马尼亚文',
    hu: '匈牙利文',
};
/**
 * 检测文本语言
 * @param text 要检测的文本
 * @param options 检测选项
 * @returns 语言检测结果
 */
function detectLanguage(text, options) {
    const { minLength = 10, detectMultiple = false } = options || {};
    // 文本太短，无法准确检测
    if (text.length < minLength) {
        return {
            code: 'und', // undefined
            name: '未知',
            confidence: 0,
            isMixed: false,
        };
    }
    // 使用 franc 检测语言
    const francCode = franc(text);
    // 转换为 ISO 639-1 代码
    const code = LANGUAGE_MAP[francCode] || 'und';
    const name = LANGUAGE_NAMES[code] || '未知';
    // 计算置信度（基于文本长度和检测结果）
    let confidence = 0.5;
    if (francCode !== 'und') {
        // 文本越长，置信度越高
        confidence = Math.min(0.95, 0.5 + text.length / 1000);
    }
    // 检测是否为混合语言
    const isMixed = detectMixedLanguage(text);
    const result = {
        code,
        name,
        confidence,
        isMixed,
    };
    // 如果需要检测多语言
    if (detectMultiple) {
        result.allLanguages = detectMultipleLanguages(text);
    }
    return result;
}
/**
 * 检测是否为混合语言文本
 */
function detectMixedLanguage(text) {
    // 检测是否同时包含中文和英文
    const hasChinese = /[\u4e00-\u9fa5]/.test(text);
    const hasEnglish = /[a-zA-Z]{3,}/.test(text);
    // 检测是否包含日文假名
    const hasJapanese = /[\u3040-\u309f\u30a0-\u30ff]/.test(text);
    // 检测是否包含韩文
    const hasKorean = /[\uac00-\ud7af]/.test(text);
    // 计算检测到的语言数量
    const languageCount = [hasChinese, hasEnglish, hasJapanese, hasKorean].filter(Boolean).length;
    return languageCount > 1;
}
/**
 * 检测文本中的多种语言
 */
function detectMultipleLanguages(text) {
    const results = [];
    // 按段落分割文本
    const paragraphs = text.split(/\n\n+/);
    // 统计每种语言的出现次数
    const languageCounts = {};
    let totalParagraphs = 0;
    for (const paragraph of paragraphs) {
        if (paragraph.trim().length < 10)
            continue;
        const francCode = franc(paragraph);
        const code = LANGUAGE_MAP[francCode] || 'und';
        if (code !== 'und') {
            languageCounts[code] = (languageCounts[code] || 0) + 1;
            totalParagraphs++;
        }
    }
    // 转换为结果数组
    for (const [code, count] of Object.entries(languageCounts)) {
        results.push({
            code,
            name: LANGUAGE_NAMES[code] || '未知',
            confidence: count / totalParagraphs,
        });
    }
    // 按置信度排序
    results.sort((a, b) => b.confidence - a.confidence);
    return results;
}
/**
 * 获取语言名称
 */
function getLanguageName(code) {
    return LANGUAGE_NAMES[code] || '未知';
}
/**
 * 获取支持的语言列表
 */
function getSupportedLanguages() {
    return Object.entries(LANGUAGE_NAMES).map(([code, name]) => ({ code, name }));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFuZ3VhZ2UtZGV0ZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL2xhbmd1YWdlLWRldGVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQStGSCx3Q0FtREM7QUFtRUQsMENBRUM7QUFLRCxzREFFQztBQTVORCx1QkFBdUI7QUFDdkIsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBRTlCOztHQUVHO0FBQ0gsTUFBTSxZQUFZLEdBQTJCO0lBQzNDLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSztJQUNoQixHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUs7SUFDaEIsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ2hCLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSztJQUNoQixHQUFHLEVBQUUsSUFBSSxFQUFFLE9BQU87SUFDbEIsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPO0lBQ2xCLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSztJQUNoQixHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUs7SUFDaEIsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ2hCLEdBQUcsRUFBRSxJQUFJLEVBQUUsT0FBTztJQUNsQixHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU07SUFDakIsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPO0lBQ2xCLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTTtJQUNqQixHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU07SUFDakIsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPO0lBQ2xCLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTTtJQUNqQixHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUs7SUFDaEIsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNO0lBQ2pCLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTTtJQUNqQixHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU07SUFDakIsR0FB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Q0FBQztZQUNuQixjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3RELGVBQWUsRUFBRSxDQUFBO1FBQ25CLENBQUM7SUFDSCxDQUFDO0lBRUQsVUFBVTtJQUNWLEtBQUssTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7UUFDM0QsT0FBTyxDQUFDLElBQUksQ0FBQztZQUNYLElBQUk7WUFDSixJQUFJLEVBQUUsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUk7WUFDbEMsVUFBVSxFQUFFLEtBQUssR0FBRyxlQUFlO1NBQ3BDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxTQUFTO0lBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBRW5ELE9BQU8sT0FBTyxDQUFBO0FBQ2hCLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGVBQWUsQ0FBQyxJQUFZO0lBQzFDLE9BQU8sY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQTtBQUNyQyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixxQkFBcUI7SUFDbkMsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUMvRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDor63oqIDmo4DmtYvlt6XlhbdcbiAqIOS9v+eUqCBmcmFuYyDlupPmo4DmtYvmlofmnKzor63oqIBcbiAqL1xuXG4vLyBmcmFuYyB2NSDkvb/nlKggQ29tbW9uSlNcbmNvbnN0IGZyYW5jID0gcmVxdWlyZSgnZnJhbmMnKVxuXG4vKipcbiAqIOivreiogOS7o+eggeaYoOWwhO+8iGZyYW5jIOS7o+eggSAtPiBJU08gNjM5LTHvvIlcbiAqL1xuY29uc3QgTEFOR1VBR0VfTUFQOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICBjbW46ICd6aCcsIC8vIOS4reaWh1xuICBlbmc6ICdlbicsIC8vIOiLseaWh1xuICBmcmE6ICdmcicsIC8vIOazleaWh1xuICBkZXU6ICdkZScsIC8vIOW+t+aWh1xuICBzcGE6ICdlcycsIC8vIOilv+ePreeJmeaWh1xuICBwb3I6ICdwdCcsIC8vIOiRoeiQhOeJmeaWh1xuICBydXM6ICdydScsIC8vIOS/hOaWh1xuICBqcG46ICdqYScsIC8vIOaXpeaWh1xuICBrb3I6ICdrbycsIC8vIOmfqeaWh1xuICBhcmE6ICdhcicsIC8vIOmYv+aLieS8r+aWh1xuICBoaW46ICdoaScsIC8vIOWNsOWcsOaWh1xuICBpdGE6ICdpdCcsIC8vIOaEj+Wkp+WIqeaWh1xuICBubGQ6ICdubCcsIC8vIOiNt+WFsOaWh1xuICBwb2w6ICdwbCcsIC8vIOazouWFsOaWh1xuICB0dXI6ICd0cicsIC8vIOWcn+iAs+WFtuaWh1xuICB2aWU6ICd2aScsIC8vIOi2iuWNl+aWh1xuICB0aGE6ICd0aCcsIC8vIOazsOaWh1xuICBpbmQ6ICdpZCcsIC8vIOWNsOWwvOaWh1xuICBzd2U6ICdzdicsIC8vIOeRnuWFuOaWh1xuICBkYW46ICdkYScsIC8vIOS4uem6puaWh1xuICBub3I6ICdubycsIC8vIOaMquWogeaWh1xuICBmaW46ICdmaScsIC8vIOiKrOWFsOaWh1xuICBjZXM6ICdjcycsIC8vIOaNt+WFi+aWh1xuICBlbGw6ICdlbCcsIC8vIOW4jOiFiuaWh1xuICBoZWI6ICdoZScsIC8vIOW4jOS8r+adpeaWh1xuICB1a3I6ICd1aycsIC8vIOS5jOWFi+WFsOaWh1xuICByb246ICdybycsIC8vIOe9l+mprOWwvOS6muaWh1xuICBodW46ICdodScsIC8vIOWMiOeJmeWIqeaWh1xufVxuXG4vKipcbiAqIOivreiogOWQjeensOaYoOWwhFxuICovXG5jb25zdCBMQU5HVUFHRV9OQU1FUzogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgemg6ICfkuK3mlocnLFxuICBlbjogJ+iLseaWhycsXG4gIGZyOiAn5rOV5paHJyxcbiAgZGU6ICflvrfmlocnLFxuICBlczogJ+ilv+ePreeJmeaWhycsXG4gIHB0OiAn6JGh6JCE54mZ5paHJyxcbiAgcnU6ICfkv4TmlocnLFxuICBqYTogJ+aXpeaWhycsXG4gIGtvOiAn6Z+p5paHJyxcbiAgYXI6ICfpmL/mi4nkvK/mlocnLFxuICBoaTogJ+WNsOWcsOaWhycsXG4gIGl0OiAn5oSP5aSn5Yip5paHJyxcbiAgbmw6ICfojbflhbDmlocnLFxuICBwbDogJ+azouWFsOaWhycsXG4gIHRyOiAn5Zyf6ICz5YW25paHJyxcbiAgdmk6ICfotorljZfmlocnLFxuICB0aDogJ+azsOaWhycsXG4gIGlkOiAn5Y2w5bC85paHJyxcbiAgc3Y6ICfnkZ7lhbjmlocnLFxuICBkYTogJ+S4uem6puaWhycsXG4gIG5vOiAn5oyq5aiB5paHJyxcbiAgZmk6ICfoiqzlhbDmlocnLFxuICBjczogJ+aNt+WFi+aWhycsXG4gIGVsOiAn5biM6IWK5paHJyxcbiAgaGU6ICfluIzkvK/mnaXmlocnLFxuICB1azogJ+S5jOWFi+WFsOaWhycsXG4gIHJvOiAn572X6ams5bC85Lqa5paHJyxcbiAgaHU6ICfljIjniZnliKnmlocnLFxufVxuXG4vKipcbiAqIOivreiogOajgOa1i+e7k+aenFxuICovXG5leHBvcnQgaW50ZXJmYWNlIExhbmd1YWdlRGV0ZWN0aW9uUmVzdWx0IHtcbiAgLyoqIElTTyA2MzktMSDor63oqIDku6PnoIEgKi9cbiAgY29kZTogc3RyaW5nXG4gIC8qKiDor63oqIDlkI3np7AgKi9cbiAgbmFtZTogc3RyaW5nXG4gIC8qKiDnva7kv6HluqbvvIgwLTHvvIkgKi9cbiAgY29uZmlkZW5jZTogbnVtYmVyXG4gIC8qKiDmmK/lkKbkuLrmt7flkIjor63oqIAgKi9cbiAgaXNNaXhlZDogYm9vbGVhblxuICAvKiog5qOA5rWL5Yiw55qE5omA5pyJ6K+t6KiAICovXG4gIGFsbExhbmd1YWdlcz86IEFycmF5PHsgY29kZTogc3RyaW5nOyBuYW1lOiBzdHJpbmc7IGNvbmZpZGVuY2U6IG51bWJlciB9PlxufVxuXG4vKipcbiAqIOajgOa1i+aWh+acrOivreiogFxuICogQHBhcmFtIHRleHQg6KaB5qOA5rWL55qE5paH5pysXG4gKiBAcGFyYW0gb3B0aW9ucyDmo4DmtYvpgInpoblcbiAqIEByZXR1cm5zIOivreiogOajgOa1i+e7k+aenFxuICovXG5leHBvcnQgZnVuY3Rpb24gZGV0ZWN0TGFuZ3VhZ2UoXG4gIHRleHQ6IHN0cmluZyxcbiAgb3B0aW9ucz86IHtcbiAgICAvKiog5pyA5bCP5paH5pys6ZW/5bqm77yI6buY6K6k77yaMTDvvIkgKi9cbiAgICBtaW5MZW5ndGg/OiBudW1iZXJcbiAgICAvKiog5piv5ZCm5qOA5rWL5aSa6K+t6KiA77yI6buY6K6k77yaZmFsc2XvvIkgKi9cbiAgICBkZXRlY3RNdWx0aXBsZT86IGJvb2xlYW5cbiAgfVxuKTogTGFuZ3VhZ2VEZXRlY3Rpb25SZXN1bHQge1xuICBjb25zdCB7IG1pbkxlbmd0aCA9IDEwLCBkZXRlY3RNdWx0aXBsZSA9IGZhbHNlIH0gPSBvcHRpb25zIHx8IHt9XG5cbiAgLy8g5paH5pys5aSq55+t77yM5peg5rOV5YeG56Gu5qOA5rWLXG4gIGlmICh0ZXh0Lmxlbmd0aCA8IG1pbkxlbmd0aCkge1xuICAgIHJldHVybiB7XG4gICAgICBjb2RlOiAndW5kJywgLy8gdW5kZWZpbmVkXG4gICAgICBuYW1lOiAn5pyq55+lJyxcbiAgICAgIGNvbmZpZGVuY2U6IDAsXG4gICAgICBpc01peGVkOiBmYWxzZSxcbiAgICB9XG4gIH1cblxuICAvLyDkvb/nlKggZnJhbmMg5qOA5rWL6K+t6KiAXG4gIGNvbnN0IGZyYW5jQ29kZSA9IGZyYW5jKHRleHQpXG5cbiAgLy8g6L2s5o2i5Li6IElTTyA2MzktMSDku6PnoIFcbiAgY29uc3QgY29kZSA9IExBTkdVQUdFX01BUFtmcmFuY0NvZGVdIHx8ICd1bmQnXG4gIGNvbnN0IG5hbWUgPSBMQU5HVUFHRV9OQU1FU1tjb2RlXSB8fCAn5pyq55+lJ1xuXG4gIC8vIOiuoeeul+e9ruS/oeW6pu+8iOWfuuS6juaWh+acrOmVv+W6puWSjOajgOa1i+e7k+aenO+8iVxuICBsZXQgY29uZmlkZW5jZSA9IDAuNVxuICBpZiAoZnJhbmNDb2RlICE9PSAndW5kJykge1xuICAgIC8vIOaWh+acrOi2iumVv++8jOe9ruS/oeW6pui2iumrmFxuICAgIGNvbmZpZGVuY2UgPSBNYXRoLm1pbigwLjk1LCAwLjUgKyB0ZXh0Lmxlbmd0aCAvIDEwMDApXG4gIH1cblxuICAvLyDmo4DmtYvmmK/lkKbkuLrmt7flkIjor63oqIBcbiAgY29uc3QgaXNNaXhlZCA9IGRldGVjdE1peGVkTGFuZ3VhZ2UodGV4dClcblxuICBjb25zdCByZXN1bHQ6IExhbmd1YWdlRGV0ZWN0aW9uUmVzdWx0ID0ge1xuICAgIGNvZGUsXG4gICAgbmFtZSxcbiAgICBjb25maWRlbmNlLFxuICAgIGlzTWl4ZWQsXG4gIH1cblxuICAvLyDlpoLmnpzpnIDopoHmo4DmtYvlpJror63oqIBcbiAgaWYgKGRldGVjdE11bHRpcGxlKSB7XG4gICAgcmVzdWx0LmFsbExhbmd1YWdlcyA9IGRldGVjdE11bHRpcGxlTGFuZ3VhZ2VzKHRleHQpXG4gIH1cblxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8qKlxuICog5qOA5rWL5piv5ZCm5Li65re35ZCI6K+t6KiA5paH5pysXG4gKi9cbmZ1bmN0aW9uIGRldGVjdE1peGVkTGFuZ3VhZ2UodGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIC8vIOajgOa1i+aYr+WQpuWQjOaXtuWMheWQq+S4reaWh+WSjOiLseaWh1xuICBjb25zdCBoYXNDaGluZXNlID0gL1tcXHU0ZTAwLVxcdTlmYTVdLy50ZXN0KHRleHQpXG4gIGNvbnN0IGhhc0VuZ2xpc2ggPSAvW2EtekEtWl17Myx9Ly50ZXN0KHRleHQpXG5cbiAgLy8g5qOA5rWL5piv5ZCm5YyF5ZCr5pel5paH5YGH5ZCNXG4gIGNvbnN0IGhhc0phcGFuZXNlID0gL1tcXHUzMDQwLVxcdTMwOWZcXHUzMGEwLVxcdTMwZmZdLy50ZXN0KHRleHQpXG5cbiAgLy8g5qOA5rWL5piv5ZCm5YyF5ZCr6Z+p5paHXG4gIGNvbnN0IGhhc0tvcmVhbiA9IC9bXFx1YWMwMC1cXHVkN2FmXS8udGVzdCh0ZXh0KVxuXG4gIC8vIOiuoeeul+ajgOa1i+WIsOeahOivreiogOaVsOmHj1xuICBjb25zdCBsYW5ndWFnZUNvdW50ID0gW2hhc0NoaW5lc2UsIGhhc0VuZ2xpc2gsIGhhc0phcGFuZXNlLCBoYXNLb3JlYW5dLmZpbHRlcihCb29sZWFuKS5sZW5ndGhcblxuICByZXR1cm4gbGFuZ3VhZ2VDb3VudCA+IDFcbn1cblxuLyoqXG4gKiDmo4DmtYvmlofmnKzkuK3nmoTlpJrnp43or63oqIBcbiAqL1xuZnVuY3Rpb24gZGV0ZWN0TXVsdGlwbGVMYW5ndWFnZXMoXG4gIHRleHQ6IHN0cmluZ1xuKTogQXJyYXk8eyBjb2RlOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyIH0+IHtcbiAgY29uc3QgcmVzdWx0czogQXJyYXk8eyBjb2RlOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyIH0+ID0gW11cblxuICAvLyDmjInmrrXokL3liIblibLmlofmnKxcbiAgY29uc3QgcGFyYWdyYXBocyA9IHRleHQuc3BsaXQoL1xcblxcbisvKVxuXG4gIC8vIOe7n+iuoeavj+enjeivreiogOeahOWHuueOsOasoeaVsFxuICBjb25zdCBsYW5ndWFnZUNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gIGxldCB0b3RhbFBhcmFncmFwaHMgPSAwXG5cbiAgZm9yIChjb25zdCBwYXJhZ3JhcGggb2YgcGFyYWdyYXBocykge1xuICAgIGlmIChwYXJhZ3JhcGgudHJpbSgpLmxlbmd0aCA8IDEwKSBjb250aW51ZVxuXG4gICAgY29uc3QgZnJhbmNDb2RlID0gZnJhbmMocGFyYWdyYXBoKVxuICAgIGNvbnN0IGNvZGUgPSBMQU5HVUFHRV9NQVBbZnJhbmNDb2RlXSB8fCAndW5kJ1xuXG4gICAgaWYgKGNvZGUgIT09ICd1bmQnKSB7XG4gICAgICBsYW5ndWFnZUNvdW50c1tjb2RlXSA9IChsYW5ndWFnZUNvdW50c1tjb2RlXSB8fCAwKSArIDFcbiAgICAgIHRvdGFsUGFyYWdyYXBocysrXG4gICAgfVxuICB9XG5cbiAgLy8g6L2s5o2i5Li657uT5p6c5pWw57uEXG4gIGZvciAoY29uc3QgW2NvZGUsIGNvdW50XSBvZiBPYmplY3QuZW50cmllcyhsYW5ndWFnZUNvdW50cykpIHtcbiAgICByZXN1bHRzLnB1c2goe1xuICAgICAgY29kZSxcbiAgICAgIG5hbWU6IExBTkdVQUdFX05BTUVTW2NvZGVdIHx8ICfmnKrnn6UnLFxuICAgICAgY29uZmlkZW5jZTogY291bnQgLyB0b3RhbFBhcmFncmFwaHMsXG4gICAgfSlcbiAgfVxuXG4gIC8vIOaMiee9ruS/oeW6puaOkuW6j1xuICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuY29uZmlkZW5jZSAtIGEuY29uZmlkZW5jZSlcblxuICByZXR1cm4gcmVzdWx0c1xufVxuXG4vKipcbiAqIOiOt+WPluivreiogOWQjeensFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VOYW1lKGNvZGU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBMQU5HVUFHRV9OQU1FU1tjb2RlXSB8fCAn5pyq55+lJ1xufVxuXG4vKipcbiAqIOiOt+WPluaUr+aMgeeahOivreiogOWIl+ihqFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VzKCk6IEFycmF5PHsgY29kZTogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfT4ge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXMoTEFOR1VBR0VfTkFNRVMpLm1hcCgoW2NvZGUsIG5hbWVdKSA9PiAoeyBjb2RlLCBuYW1lIH0pKVxufVxuIl19